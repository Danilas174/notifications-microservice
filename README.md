# Общая информация

Этот проект создает WebSocket и Express сервер для обработки подписок пользователей на определенные события и задумывается как универсальный микросервис ответственный за уведомления.

## Функциональность

<details>

<summary>  Пояснение к полям</summary>

## `type`

Говорит сервису хотим ли мы подписаться на событие или отписаться от него. Может иметь только два значения:

- `"subscribe"` - подписка
- `"unsubscribe"` - отписка

```json
{
    ...
    "type": "subscribe" или "unsubscribe"
    ...
}
```

## `user_id`

> Временное поле, будет удалено позднее.
> Данные о пользователе должен обрабатывать
> сервис ответсвенный за токен.

Указывает сервису с каким пользователем будет происходить операция. Имеет числовой формат `number`.

```json
{
    ...
    "user_id": 1589 или любое другое числовое значение
    ...
}
```
4
## `event_name`

Обозначает имя события, на которое будет подписан пользователь. Имеет строковый формат `string`.

```json
{
    ...
    "event_name": "notification:test" или любое другое событие
    ...
}
```

</details>

### Подписка на события

Пользователи могут подписываться на определенные события и получать оповещения в реальном времени.
Для того чтоб подписаться на событие, клиент должен отправить сообщение в формате JSON после подключения к WSS.

```json
{
  "type": "subscribe",
  "user_id": 1589,
  "event_name": "notification:test"
}
```

### Отписка и управление соединениями

Пользователи напрямую могут отписываться от событий, сервер закроет соединение с конкретным пользователем.

```json
{
  "type": "unsubscribe",
  "user_id": 1589,
  "event_name": "notification:test"
}
```

### Авторизация

При подключении к серверу производится проверка доступа по токену для предотвращения несанкционированного доступа.
> Номинальная функция. Должна быть реализована связь с сервисом обработки


## Использование

 > Подразумевается, что сервис ответственный за запись уведомлений в базу данных настроен и работает корректно

 Необходимо настроить функции обратного вызова т.е. `хуки` таким образом, чтоб при добавлении в базу данных новой записи для конкретного события мы посылали через POST-запрос на этот сервис. Необходимо обращаться к:
 > host:port/notify
 а так же добавить тело 
 ```json
 {
    "user_id": 1589,
    "event_name": "notification:test",
    "message": //Может быть любым значением
 }
 ```

